<!DOCTYPE html>
<html>
  <head>
     <title>User Profile</title>
     <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
     <script src="app.js"></script>
  </head>
  <body>
    <script type="text/javascript">
        function signout () {
            clearAuthToken();
            refreshApp();
        }
    
        if (! hasAuthToken()) {
            if (urlParam("code")) {
                completeAuth();
            } else {
                document.body.innerHTML += "<p>Not yet authorized</p>";
                document.body.innerHTML += "<p><input type='submit' value='Sign In' onClick='authorize()'></p>";
            }
        } else {
            $.when(getPatientName())
             .then(function (name) {
                 document.body.innerHTML += "<p><input type='submit' value='Sign Out' onClick='signout()'></p>";
                document.body.innerHTML += "<p>" + new Date() + "</p>";
                document.body.innerHTML += "<p>Current patient: " + name + "</p>";

                 $.when(getBirthDate())
                     .then(function (birth) {
                         document.body.innerHTML += "<p>Birth Date: " + birth + "</p>";
                         $.when(getGender())
                             .then(function (gen) {
                                 document.body.innerHTML += "<p>Gender: " + gen + "</p>";
                                 $.when(getDceasedBoolean())
                                     .then(function (bool) {
                                         document.body.innerHTML += "<p>Deceased Boolean: " + bool + "</p>";
                                         $.when(getId())
                                             .then(function (pid) {
                                                 document.body.innerHTML += "<p>Id: " + pid + "</p>";
                                                 $.when(getCareProvider())
                                                     .then(function (carePro) {
                                                         document.body.innerHTML += "<p>Care Provider: " + carePro + "</p>";

                                                     });
                                             });
                                     })
                             })
                     })

             })


             .fail(function () {
                clearAuthToken();
                document.body.innerHTML += "<p>Authorization token appears to be invalid</p>";
                document.body.innerHTML += "<p><input type='submit' value='Sign In' onClick='authorize()'></p>";
             });



        }
    </script>
  </body>
</html>
